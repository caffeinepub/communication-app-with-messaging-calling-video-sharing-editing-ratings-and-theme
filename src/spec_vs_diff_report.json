{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-07T04:11:41.165Z",
  "summary": "Backend adds a new Directory search API that returns principal+username+displayName, and frontend updates the user search hook and Directory page to use the backend-provided principal when enabling Chat, deriving conversationId, calling addConversation, and navigating to the chat thread with error toasts.",
  "missing_requirements": [
    {
      "id": "REQ-27",
      "requirement": "If a Directory search result lacks a principal unexpectedly, the Chat button remains disabled and an error is logged (or surfaced) rather than navigating to a broken route.",
      "reason": "DirectoryPage filters out users with invalid/missing principals entirely (so they are not shown), but the diff does not show explicit logging/surfacing tied to the unexpected missing-principal case in the rendered results (only logging occurs when handleStartChat is invoked).",
      "evidence": [
        "frontend/src/pages/DirectoryPage.tsx (truncated): `const validUsers = users?.filter(user => user.principal && isValidPrincipal(user.principal)) || [];`"
      ]
    }
  ],
  "hallucinated_features": [],
  "confidence": 0.66,
  "changed_files": [
    "backend/main.mo",
    "frontend-file-summaries.txt",
    "frontend/src/hooks/useAddConversation.ts",
    "frontend/src/hooks/useUserSearch.ts",
    "frontend/src/pages/DirectoryPage.tsx",
    "project_state.json"
  ]
}